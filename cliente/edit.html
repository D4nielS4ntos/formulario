<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <main>
        <section id="head">
            <h2>Tabela Usuários</h2>
        </section>
        <section class="contentline">
            <table>
                <tr>
                    <th>Id</th>
                    <th>Nome</th>
                    <th>Conta</th>
                    <th>senha</th>
                </tr>
            </table>
        </section>
    </main>
    <script>
        let main = document.querySelector('main')
        let table = document.querySelector('table')

        async function gerarTabela() {
            try {
                let response = await fetch('/cadastrar')
                if (!response.ok) throw new Error("Erro ao excluir a cidade");
                let data = await response.json()
                for (element of data) {
                    table.innerHTML += criarLinha(element)
                }
                alterarDado()
                deletarDado()   
            } catch (error) {
                console.error(`Erro ao tentar excluir cidade ${error}`)
            }
        }
        gerarTabela()


        function alterarDado() {
            let botoesDeAlterar = document.querySelectorAll('.altbutton')
            botoesDeAlterar.forEach(botaoDeAlterar => {
                botaoDeAlterar.addEventListener('click', () => {
                    const CoUsuario = botaoDeAlterar.getAttribute('altbutton-id')
                    alterar(CoUsuario)
                })
            })
        }


        function deletarDado() {
            let botoesDeAlterar = document.querySelectorAll('.delbutton')
            botoesDeAlterar.forEach(botaoDeAlterar => {
                botaoDeAlterar.addEventListener('click', () => {
                    const CoUsuario = botaoDeAlterar.getAttribute('delbutton-id')
                    deletar(CoUsuario)
                })
            })
        }


        function alterar(id) {
            main.innerHTML = ""
            main.innerHTML += criarHeader("Alterar Usuário")
            main.innerHTML += criarFormulario()
            alert(id)
        }

        function deletar(id) {
            const response = fetch(`/cadastrar/${id}`, { method: "DELETE" })
                    if (!response.ok) throw new Error("Erro ao excluir dado")
        }

                
        function criarLinha(element) {
            const { id, nome, email, senha } = element
            const dadosUsuario =  `<tr id="usuario${id}">
                                    <td class="center">${id}</td>
                                    <td>${nome}</td>
                                    <td>${email}</td>
                                    <td class="right">${senha}</td>
                                    <td class="botão right">
                                        <button class="altbutton" altbutton-id="${id}">Alterar</button>
                                    </td>
                                    <td class="botão">
                                        <button class="delbutton" delbutton-id="${id}">Deletar</button>
                                    </td>
                                </tr>`
            return dadosUsuario
        }


        function criarHeader(titulo) {
            const header =    `<section id="head">
                                <h2>${titulo}</h2>
                            </section>`
            return header
        }


        function criarFormulario() {
            const paginaAlterar = `<form>
                                <section class="contentline">
                                    <label for="username">Nome do usuário</label>
                                    <input type="text" class="campo" id="username" placeholder="Digite o nome do usuário...">
                                    <a></a>
                                </section>
                                <section class="contentline">
                                    <label for="email">Email</label>
                                    <input type="text" class="campo" id="email" placeholder="Digite seu email...">
                                    <a></a>
                                </section>
                                <section class="contentline">
                                    <label for="senha">Senha</label>
                                    <input type="password" class="campo" id="senha" placeholder="Digite sua senha...">
                                    <a></a>
                                </section>
                                <section class="contentline">
                                    <label for="senhaconfir">Confirmação de senha</label>
                                    <input type="password" class="campo" id="senhaconfirm" placeholder="Digite sua senha novamente...">
                                    <a></a>
                                </section>
                                <section id="content" class="contentline">
                                    <button id="cadastro" type="button">Cadastrar</button>
                                </section>
                                </form>`
            return paginaAlterar
        }
    </script>
    <!-- <script src="views/edit.js"></script> -->
    <!-- <script src="views/formulário.js"></script> -->
</body>
</html>